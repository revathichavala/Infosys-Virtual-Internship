# TASK 1: Data Loading & Structure Understanding

import pandas as pd
import numpy as np
from google.colab import files

print("\n=== TASK 1: DATA LOADING & STRUCTURE UNDERSTANDING ===")

uploaded = files.upload()
file_name = list(uploaded.keys())[0]
df = pd.read_csv(file_name)

print('\nShape:', df.shape)
print('\nColumns:', df.columns.tolist())
print('\nData Types:\n', df.dtypes)
print('\nNumerical Columns:', df.select_dtypes(include=[np.number]).columns.tolist())
print('\nCategorical Columns:', df.select_dtypes(exclude=[np.number]).columns.tolist())

print('\nFirst 5 rows:')
print(df.head().to_string(index=False))

# TASK 2: Data Cleaning

import numpy as np

print("\n=== TASK 2: DATA CLEANING ===")

print('\nMissing Values:\n', df.isnull().sum())

# Fill numeric missing values
num_cols = df.select_dtypes(include=[np.number]).columns.tolist()
for c in num_cols:
    if df[c].isnull().any():
        df[c].fillna(df[c].median(), inplace=True)
        print(f"Filled missing values in {c} with median")

# Fill categorical missing values
cat_cols = df.select_dtypes(exclude=[np.number]).columns.tolist()
for c in cat_cols:
    if df[c].isnull().any():
        df[c].fillna(df[c].mode()[0], inplace=True)
        print(f"Filled missing values in {c} with mode")

# pH validity check
if "pH" in df.columns:
    df.loc[df["pH"] < 0, "pH"] = 0
    df.loc[df["pH"] > 14, "pH"] = 14
    print("Corrected invalid pH values (clipped to 0–14)")

# Remove duplicates
dups = df.duplicated().sum()
print("Duplicate rows found:", dups)
df.drop_duplicates(inplace=True)
print("After cleaning shape:", df.shape)

# TASK 3: Univariate Analysis

import matplotlib.pyplot as plt
import seaborn as sns

print("\n=== TASK 3: UNIVARIATE ANALYSIS ===")

for col in df.select_dtypes(include=[np.number]).columns:
    print(f"\n--- {col} Summary ---")
    print(df[col].describe())

    print("\nPlotting Histogram, KDE and Boxplot...\n")

    fig, ax = plt.subplots(1,3, figsize=(18,4))
    sns.histplot(df[col], kde=True, ax=ax[0]); ax[0].set_title(f"{col} Histogram")
    sns.kdeplot(df[col], ax=ax[1]); ax[1].set_title(f"{col} KDE")
    sns.boxplot(x=df[col], ax=ax[2]); ax[2].set_title(f"{col} Boxplot")
    plt.show()
# --- TASK 4: BIVARIATE ANALYSIS WITH is_safe ---

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

print("\n=== TASK 4: BIVARIATE ANALYSIS WITH is_safe ===")

# quick safe conversion (coerce bad values to NaN, then drop them)
df['is_safe'] = pd.to_numeric(df['is_safe'], errors='coerce')
n_invalid = df['is_safe'].isna().sum()
print(f"\nInvalid/non-numeric is_safe entries: {n_invalid}")
if n_invalid > 0:
    # show examples (up to 10)
    print("\nExamples of invalid is_safe values:")
    print(df[df['is_safe'].isna()].head(10).to_string(index=False))
    # drop them (keeps code short like Car_Sales notebook)
    df = df[df['is_safe'].notna()].copy()
    print(f"\nDropped {n_invalid} rows with invalid is_safe. New shape: {df.shape}")

# finalize as int
df['is_safe'] = df['is_safe'].astype(int)

print("\nClass Counts:\n", df['is_safe'].value_counts())

# countplot
plt.figure(figsize=(5,4))
sns.countplot(x=df['is_safe'])
plt.title("is_safe Countplot")
plt.show()

# boxplot + mean barplot for each numeric feature (except is_safe)
num_cols = [c for c in df.select_dtypes(include=['number']).columns if c != 'is_safe']
for col in num_cols:
    print(f"\n--- {col} vs is_safe ---")
    plt.figure(figsize=(12,4))

    plt.subplot(1,2,1)
    sns.boxplot(x='is_safe', y=col, data=df)
    plt.title(f"{col} by is_safe")

    plt.subplot(1,2,2)
    sns.barplot(x='is_safe', y=col, data=df, ci=None)
    plt.title(f"Mean {col} by is_safe")

    plt.tight_layout()
    plt.show()

    # print group means (short)
    print("Means:\n", df.groupby('is_safe')[col].mean())
# TASK 5: Correlation Analysis

import matplotlib.pyplot as plt
import seaborn as sns

print("\n=== TASK 5: CORRELATION ANALYSIS ===")

corr = df.corr()
print("\nCorrelation Matrix:\n", corr)

plt.figure(figsize=(10,8))
sns.heatmap(corr, annot=True, cmap='coolwarm')
plt.title("Correlation Heatmap")
plt.show()

if "is_safe" in df.columns:
    print("\nCorrelation with is_safe:\n", corr['is_safe'].sort_values(ascending=False))
# TASK 6: Outlier Detection

import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

print("\n=== TASK 6: OUTLIER DETECTION ===")

outliers = {}

num_cols = df.select_dtypes(include=[np.number]).columns.tolist()

for col in num_cols:
    if col == 'is_safe': continue

    q1 = df[col].quantile(0.25)
    q3 = df[col].quantile(0.75)
    iqr = q3 - q1
    lower = q1 - 1.5*iqr
    upper = q3 + 1.5*iqr

    outliers[col] = ((df[col] < lower) | (df[col] > upper)).sum()

print("\nOutlier counts per feature:\n", outliers)

# Show boxplots for visual confirmation
for col in num_cols:
    if col == 'is_safe': continue
    sns.boxplot(x=df[col])
    plt.title(f"Outliers in {col}")
    plt.show()

# TASK 7: Feature Relationships

import seaborn as sns
import matplotlib.pyplot as plt

print("\n=== TASK 7: FEATURE RELATIONSHIPS ===")

num_cols = df.select_dtypes(include=[float, int]).columns.tolist()

print("\nCreating Pairplot… (may take time)")
sns.pairplot(df[num_cols], diag_kind='kde')
plt.show()

if "pH" in df.columns and "Conductivity" in df.columns:
    print("\nPlotting pH vs Conductivity...")

    sns.jointplot(x='pH', y='Conductivity', data=df, kind='scatter')
    plt.show()

